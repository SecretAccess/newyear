<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>お年玉抽選ツール</title>
  <!-- スマホ対応 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(to right, #ffecd2, #fcb69f);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      text-align: center;
      background-color: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      width: 95%;
      max-width: 480px;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      color: #ff4500;
    }
    .select-wrapper {
      margin-bottom: 20px;
    }
    label {
      font-size: 1rem;
      margin-right: 5px;
    }
    select {
      font-size: 1rem;
      padding: 6px 10px;
      border-radius: 5px;
    }
    button {
      padding: 12px 20px;
      font-size: 1rem;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin: 10px 5px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    button:hover:enabled {
      background-color: #45a049;
    }
    #drawArea {
      margin-top: 15px;
      min-height: 200px; /* 結果表示スペース */
    }
    .slot {
      display: inline-block;
      margin: 5px;
      text-align: center;
      vertical-align: top;
      width: 80px;
      height: 110px;
      position: relative;
    }
    .slot img {
      width: 60px;
      height: auto;
      transition: transform 0.3s;
    }
    .slot img:hover {
      transform: scale(1.1);
    }
    .slot .amount-label {
      display: block;
      font-size: 0.9rem;
      margin-top: 3px;
      color: #333;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>🎉お年玉抽選(10連ガチャ)🎉</h1>

  <!-- 学年区分選択 -->
  <div class="select-wrapper">
    <label for="gradeSelect">学年を選択：</label>
    <select id="gradeSelect">
      <option value="">選択してください</option>
      <option value="未就学児">未就学児</option>
      <option value="小1">小1</option>
      <option value="小2">小2</option>
      <option value="小3">小3</option>
      <option value="小4">小4</option>
      <option value="小5">小5</option>
      <option value="小6">小6</option>
      <option value="中1">中1</option>
      <option value="中2">中2</option>
      <option value="中3">中3</option>
      <option value="高校生以上">高校生以上</option>
    </select>
  </div>

  <!-- 10連ガチャボタン -->
  <button id="drawButton" disabled>10連ガチャを回す</button>

  <!-- ガチャ結果表示エリア -->
  <div id="drawArea"></div>
</div>

<script>
//===================================================================
// 1) 紙幣/ハズレ 画像マップ
//===================================================================
const imageMap = {
  1000: 'kitasato.png',
  5000: 'umeko.png',
  10000: 'shibusawa.png',
  hazure: 'hazure.png'
};

//===================================================================
// 2) メインパターン(70%)とサブパターン(30%)を各学年区分に定義
//   - メインパターン = 学年別の代表合計金額を作る10個の組み合わせ
//   - サブパターン = その他の合計(2000/3000/4000/...10000)を複数通り用意（約10通り）
//   ここでは各学年につき
//    メイン: 1通り
//    サブ:   10通り
//===================================================================
const patternByGrade = {
  // --------------------------
  //  未就学児
  //  メイン： 1000x2 + ハズレ8 = 2000円
  // --------------------------
  "未就学児": {
    main: {
      combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 3000円
      { combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 1000×5 =5000円 別パターン
      { combo: [1000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1枚)
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2) 別パターン
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  小1
  //  メイン： 1000x3 + ハズレ7 = 3000円
  // --------------------------
  "小1": {
    main: {
      combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1枚)
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円(1000×5)
      { combo: [1000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  小2
  //  メイン： 1000x3 + ハズレ7 = 3000円
  // --------------------------
  "小2": {
    main: {
      combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 以下、小1 と同じ構成
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  小3
  //  メイン： 1000x3 + ハズレ7 = 3000円
  // --------------------------
  "小3": {
    main: {
      combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1枚)
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円(1000×5)
      { combo: [1000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  小4
  //  メイン： 1000x3 + ハズレ7 = 3000円
  // --------------------------
  "小4": {
    main: {
      combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1枚)
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円(1000×5)
      { combo: [1000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  小5
  //  メイン： 1000x3 + ハズレ7 = 3000円
  // --------------------------
  "小5": {
    main: {
      combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円(1000×5)
      { combo: [1000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  小6
  //  メイン： 5000×1 + ハズレ9 = 5000円
  // --------------------------
  "小6": {
    main: {
      combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 3000円
      { combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 10000円(1枚)
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)2回目
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  中1
  //  メイン： 5000×1 + ハズレ9 = 5000円
  // --------------------------
  "中1": {
    main: {
      combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 小6と同様
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  中2
  //  メイン： 5000×1 + ハズレ9 = 5000円
  // --------------------------
  "中2": {
    main: {
      combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  中3
  //  メイン： 5000×1 + ハズレ9 = 5000円
  // --------------------------
 "中3": {
    main: {
      combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円（1000×2）
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 3000円（1000×3）
      { combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円（1000×4）
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 7000円（5000 + 1000×2）
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円（5000 + 1000×3）
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円（5000 + 1000×4）
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
      // 10000円(1枚)
      { combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2) 別アレンジ
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
    ]
  },

  // --------------------------
  //  高校生以上
  //  メイン： 10000×1 + ハズレ9 = 10000円
  // --------------------------
  "高校生以上": {
    main: {
      combo: [10000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"],
      prob: 0.70
    },
    subs: [
      // 2000円
      { combo: [1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 3000円
      { combo: [1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 4000円
      { combo: [1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 5000円
      { combo: [5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 6000円
      { combo: [5000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 7000円
      { combo: [5000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 8000円
      { combo: [5000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 9000円
      { combo: [5000,1000,1000,1000,1000,"hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(5000×2)
      { combo: [5000,5000,"hazure","hazure","hazure","hazure","hazure","hazure","hazure","hazure"] },
      // 10000円(1000×10)
      { combo: [1000,1000,1000,1000,1000,1000,1000,1000,1000,1000] },
    ]
  }
};

//---------------------------------------------------------
// DOMの取得
//---------------------------------------------------------
const gradeSelect = document.getElementById('gradeSelect');
const drawButton  = document.getElementById('drawButton');
const drawArea    = document.getElementById('drawArea');

// 学年未選択ならボタン無効
gradeSelect.addEventListener('change', () => {
  drawButton.disabled = (gradeSelect.value === "");
});

//---------------------------------------------------------
// 10連ガチャを回す
//---------------------------------------------------------
drawButton.addEventListener('click', () => {
  drawArea.innerHTML = ''; // リセット

  const gradeData = patternByGrade[gradeSelect.value];
  if (!gradeData) return;

  // 1) 「メインパターン」(prob=0.70) か「サブパターン」(30%を分割) のいずれかを選ぶ
  const r = Math.random();
  let finalCombo;
  if (r <= gradeData.main.prob) {
    finalCombo = gradeData.main.combo;
  } else {
    // サブパターンから1つ均等に選ぶ
    const subs = gradeData.subs;
    // サブパターンは合計で30% → それを subs.length で均等割り (1サブパターンあたり => 0.30 / subs.length)
    // 例: subsが10個なら1つあたり3%
    const x = (r - gradeData.main.prob) / 0.30; // 0〜1 の範囲に正規化
    const idx = Math.floor(x * subs.length);    // 0〜(subs.length-1)
    finalCombo = subs[idx].combo;
  }

  // 2) 順序をシャッフルしてリズムよく表示
  const shuffled = shuffleArray(finalCombo.slice());
  const total = calcTotal(finalCombo); // 合計金額(並び順関係なく)

  let index = 0;
  const maxPulls = 10;

  function pullOne() {
    if (index >= maxPulls) {
      // 10回終了後に合計金額を表示
      setTimeout(() => {
        alert(`あなたの今年のお年玉は${total}円`);
      }, 400);
      return;
    }

    // スロット要素を作成
    const slotDiv = document.createElement('div');
    slotDiv.className = 'slot';
    const img = document.createElement('img');
    img.src = '';
    const label = document.createElement('span');
    label.className = 'amount-label';

    slotDiv.appendChild(img);
    slotDiv.appendChild(label);
    drawArea.appendChild(slotDiv);

    // 0.3秒後に結果確定
    setTimeout(() => {
      const val = shuffled[index];
      if (val === "hazure") {
        img.src = imageMap["hazure"];
        label.textContent = "ハズレ";
      } else {
        img.src = imageMap[val];
        label.textContent = val + "円";
      }
    }, 300);

    index++;
    // 次のスロットを 0.6秒後に
    setTimeout(pullOne, 600);
  }
  pullOne();
});

//---------------------------------------------------------
// 配列をシャッフル(Fisher-Yates)
//---------------------------------------------------------
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

//---------------------------------------------------------
// 10個の要素から合計金額を算出
//---------------------------------------------------------
function calcTotal(arrayOf10) {
  let sum = 0;
  for (let val of arrayOf10) {
    if (val !== "hazure") {
      sum += (typeof val === "number" ? val : 0);
    }
  }
  return sum;
}
</script>
</body>
</html>
